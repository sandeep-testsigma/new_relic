import{g as p,a as y,b as A,n as u}from"./bel-serializer-x_5ebQnz.js";import{l,W as m,X as g,d as h,y as v,h as S,c as E}from"./index-BU7ycNNo.js";import{c as C,A as I}from"./aggregate-base-C_iCLCUb.js";import{V as f,b as d,D as F,r as N,o as R,f as L,a as D}from"./first-paint-CGGyxHZy.js";import{t as U}from"./time-to-first-byte-CuzK1dai.js";import{e as _}from"./event-origin-Bb7irpQQ.js";const o=new f(d.CUMULATIVE_LAYOUT_SHIFT,r=>r);l&&F(({value:r,attribution:e,id:i})=>{const t={metricId:i,largestShiftTarget:e.largestShiftTarget,largestShiftTime:e.largestShiftTime,largestShiftValue:e.largestShiftValue,loadState:e.loadState};o.update({value:r,attrs:t})},{reportAllChanges:!0});const T=new f(d.INTERACTION_TO_NEXT_PAINT);l&&N(({value:r,attribution:e,id:i})=>{const t={metricId:i,eventTarget:e.interactionTarget,eventTime:e.interactionTime,interactionTarget:e.interactionTarget,interactionTime:e.interactionTime,interactionType:e.interactionType,inputDelay:e.inputDelay,nextPaintTime:e.nextPaintTime,processingDuration:e.processingDuration,presentationDelay:e.presentationDelay,loadState:e.loadState};T.update({value:r,attrs:t})});const c=new f(d.LARGEST_CONTENTFUL_PAINT);l&&R(({value:r,attribution:e})=>{if(m||c.isValid)return;let i;const t=e.lcpEntry;t&&(i={size:t.size,eid:t.id,element:e.element,timeToFirstByte:e.timeToFirstByte,resourceLoadDelay:e.resourceLoadDelay,resourceLoadDuration:e.resourceLoadDuration,resourceLoadTime:e.resourceLoadDuration,elementRenderDelay:e.elementRenderDelay},e.url&&(i.elUrl=C(e.url)),t.element?.tagName&&(i.elTag=t.element.tagName)),c.update({value:r,attrs:i})});class b extends I{static featureName=g;#e=({name:e,value:i,attrs:t})=>{this.addTiming(e,i,t)};constructor(e){super(e,g),this.curSessEndRecorded=!1,this.firstIxnRecorded=!1,h("docHidden",i=>this.endCurrentSession(i),this.featureName,this.ee),h("winPagehide",i=>this.addTiming("unload",i,null),this.featureName,this.ee),this.waitForFlags([]).then(()=>{L.subscribe(this.#e),D.subscribe(this.#e),c.subscribe(this.#e),T.subscribe(this.#e),U.subscribe(({attrs:i})=>{this.addTiming("load",Math.round(i.navigationEntry.loadEventEnd))}),v(()=>{const{name:i,value:t,attrs:n}=o.current;t!==void 0&&this.addTiming(i,t*1e3,n)},!0,!0),this.drain()})}endCurrentSession(e){this.curSessEndRecorded||(this.addTiming("pageHide",e,null),this.curSessEndRecorded=!0)}addTiming(e,i,t){t=t||{},x(t),e!==d.CUMULATIVE_LAYOUT_SHIFT&&o.current.value>=0&&(t.cls=o.current.value);const n={name:e,value:i,attrs:t};return this.events.add(n),S("pvtAdded",[e,i,t],void 0,E.sessionTrace,this.ee),this.checkForFirstInteraction(),n}checkForFirstInteraction(){if(this.firstIxnRecorded||m||!performance)return;const e=performance.getEntriesByType("first-input")[0];e&&(this.firstIxnRecorded=!0,this.addTiming("fi",e.startTime,{type:e.name,eventTarget:_(e.target),loadState:document.readyState}))}appendGlobalCustomAttributes(e){var i=e.attrs||{},t=["size","eid","cls","type","fid","elTag","elUrl","net-type","net-etype","net-rtt","net-dlink"];Object.entries(this.agentRef.info.jsAttributes||{}).forEach(([n,s])=>{t.indexOf(n)<0&&(i[n]=s)})}preHarvestChecks(){return this.checkForFirstInteraction(),super.preHarvestChecks()}serializer(e){for(var i=p(this.agentRef.runtime.obfuscator),t="bel.6;",n=0;n<e.length;n++){var s=e[n];t+="e,",t+=i(s.name)+",",t+=y(s.value,u,!1)+",",this.appendGlobalCustomAttributes(s);var a=A(s.attrs,i);a&&a.length>0&&(t+=u(a.length)+";"+a.join(";")),n+1<e.length&&(t+=";")}return t}}function x(r){var e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;e&&(e.type&&(r["net-type"]=e.type),e.effectiveType&&(r["net-etype"]=e.effectiveType),e.rtt&&(r["net-rtt"]=e.rtt),e.downlink&&(r["net-dlink"]=e.downlink))}export{b as Aggregate};
//# sourceMappingURL=index-CVfrkGRP.js.map
